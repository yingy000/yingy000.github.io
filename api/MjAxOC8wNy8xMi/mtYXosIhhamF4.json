{"title":"浅谈ajax","date":"2018-07-12T02:16:37.000Z","link":"2018/07/12/浅谈ajax","tags":["AJAX"],"categories":["前端"],"updated":"2018-10-12T14:46:30.951Z","content":"<blockquote>\n<p>AJAX 即 Asynchronous Javascript And XML，不是一门的新的语言，而是对现有持术的综合利用。其本质是在HTTP协议的基础上以异步的方式与服务器进行通信。</p>\n</blockquote>\n<h2 id=\"1-XMLHttpRequest\">1.XMLHttpRequest<a href=\"2018/07/12/浅谈ajax#1-XMLHttpRequest\"></a></h2><p>浏览器内建对象，用于在后台与服务器通信(交换数据) ，由此我们便可实现对网页的部分更新，而不是刷新整个页面。(局部更新)</p>\n<p>内建对象：浏览器已经封装好了该方法，用的时候只需要new一下就可以拿来使用了。</p>\n<p>举例：我们先写请求行和请求主体</p>\n<figure class=\"highlight plain\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">\t&lt;head&gt;</span><br><span class=\"line\">\t\t&lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class=\"line\">\t\t&lt;title&gt;&lt;/title&gt;</span><br><span class=\"line\">\t\t&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class=\"line\">\t\t\t//new一下，实例化</span><br><span class=\"line\">\t\t\tvar xhr=new XMLHttpRequest;</span><br><span class=\"line\">\t\t\t//请求</span><br><span class=\"line\">\t\t\t//请求行</span><br><span class=\"line\">\t\t\txhr.open(&apos;get&apos;,&apos;01.txt&apos;);</span><br><span class=\"line\">\t\t\t//以get的方式请求，请求主体为空。</span><br><span class=\"line\">\t\t\t//请求主体</span><br><span class=\"line\">\t\t\txhr.send(null);</span><br><span class=\"line\">\t\t&lt;/script&gt;</span><br><span class=\"line\">\t&lt;/head&gt;</span><br><span class=\"line\">\t&lt;body&gt;</span><br><span class=\"line\">\t&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></div></figure>\n<p>我们可以再浏览器看一下结果：</p>\n<p><img src=\"http://images.cnblogs.com/cnblogs_com/cliy-10/1240733/o_1.png\" alt=\" \" class=\"article-img\"></p>\n<p>可以明显的看到请求的地址和请求的方法。</p>\n<p>注意：请求主体即使是空的，也要写着，这个是不能忽略的。</p>\n<p>现在可以来写请求头了</p>\n<figure class=\"highlight javascript\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//请求头</span></span><br><span class=\"line\">xhr.setRequestHeader(<span class=\"string\">'Content-Type'</span>,<span class=\"string\">'text/html'</span>);</span><br></pre></td></tr></table></div></figure>\n<p>再来刷一刷浏览器的结果：</p>\n<p><img src=\"http://images.cnblogs.com/cnblogs_com/cliy-10/1240733/o_2.png\" alt=\" \" class=\"article-img\"></p>\n<p>请求发送完了，这下我们该接收响应了。这下客户端的请求发送过来了，等到服务器空闲就去处理，本来说是客户端得一直等着服务器端的处理，其实客户端不用一直等着去干别的事情，可以设置一个监听事件<code>onreadystatechange</code>监听服务器端什么时候处理完这个请求，等服务器处理完之后客户端在接收，这样客户端就不用一直等着，这也就是异步请求的原理。</p>\n<figure class=\"highlight javascript\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//接收响应</span></span><br><span class=\"line\">\t\txhr.onreadystatechange=<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">console</span>.log(xhr.readyState);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span>(xhr.readyState==<span class=\"number\">4</span>&amp;&amp;xhr.status==<span class=\"number\">200</span>)&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">var</span> result=xhr.responseText;</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">console</span>.log(result);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br></pre></td></tr></table></div></figure>\n<p><code>onreadystatechang</code>属性一直监听着服务器端的变化，我们可以检测一下</p>\n<figure class=\"highlight javascript\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">\t&lt;head&gt;</span><br><span class=\"line\">\t\t&lt;meta charset=<span class=\"string\">\"UTF-8\"</span>&gt;</span><br><span class=\"line\">\t\t&lt;title&gt;&lt;/title&gt;</span><br><span class=\"line\">\t\t&lt;script type=<span class=\"string\">\"text/javascript\"</span>&gt;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//new一下，实例化</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">var</span> xhr=<span class=\"keyword\">new</span> XMLHttpRequest;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">console</span>.log(xhr.readyState);</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//请求</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">//请求行</span></span><br><span class=\"line\">\t\t\txhr.open(<span class=\"string\">'get'</span>,<span class=\"string\">'01.txt'</span>);</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">console</span>.log(xhr.readyState);</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//请求头</span></span><br><span class=\"line\">\t\t\txhr.setRequestHeader(<span class=\"string\">'Content-Type'</span>,<span class=\"string\">'text/html'</span>);</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">console</span>.log(xhr.readyState);</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//以get的方式请求，请求主体为空。</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">//请求主体</span></span><br><span class=\"line\">\t\t\txhr.send(<span class=\"literal\">null</span>);</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//接收响应</span></span><br><span class=\"line\">\t\t\txhr.onreadystatechange=<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">console</span>.log(xhr.readyState);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span>(xhr.readyState==<span class=\"number\">4</span>&amp;&amp;xhr.status==<span class=\"number\">200</span>)&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">var</span> result=xhr.responseText;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"built_in\">console</span>.log(result);</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&lt;<span class=\"regexp\">/script&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">\t&lt;/</span>head&gt;</span><br><span class=\"line\">\t&lt;body&gt;</span><br><span class=\"line\">\t\t&lt;p id=<span class=\"string\">\"result\"</span>&gt;&lt;/p&gt;</span><br><span class=\"line\">\t&lt;<span class=\"regexp\">/body&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">&lt;/</span>html&gt;</span><br></pre></td></tr></table></div></figure>\n<p>在浏览器控制台查看结果：</p>\n<p><img src=\"http://images.cnblogs.com/cnblogs_com/cliy-10/1240733/o_3.png\" alt=\" \" class=\"article-img\"></p>\n<p>readyState属性的所有取值以及它所使用的范围：</p>\n<p><img src=\"http://images.cnblogs.com/cnblogs_com/cliy-10/1240733/o_4.png\" alt=\" \" class=\"article-img\"></p>\n<h2 id=\"2-同步\">2.同步<a href=\"2018/07/12/浅谈ajax#2-同步\"></a></h2><p>ajax请求的方式是一个典型的异步请求的方式。我们现在可以看一下同步请求</p>\n<p><code>open()</code>方法中的第三个参数为true时，表示异步，为false时表示同步，默认为true。</p>\n<p>举例：</p>\n<figure class=\"highlight javascript\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">\t&lt;head&gt;</span><br><span class=\"line\">\t\t&lt;meta charset=<span class=\"string\">\"UTF-8\"</span>&gt;</span><br><span class=\"line\">\t\t&lt;title&gt;&lt;/title&gt;</span><br><span class=\"line\">\t\t&lt;script&gt;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">var</span> xhr=<span class=\"keyword\">new</span> XMLHttpRequest;</span><br><span class=\"line\">\t\t\txhr.open(<span class=\"string\">\"get\"</span>,<span class=\"string\">\"02.php\"</span>,<span class=\"literal\">false</span>);</span><br><span class=\"line\">\t\t\txhr.setRequestHeader(<span class=\"string\">'Content-Type'</span>,<span class=\"string\">'text/html'</span>);</span><br><span class=\"line\">\t\t\txhr.send(<span class=\"literal\">null</span>);</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">console</span>.log(<span class=\"string\">\"我是同步消息\"</span>);\t</span><br><span class=\"line\">\t\t&lt;<span class=\"regexp\">/script&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">\t&lt;/</span>head&gt;</span><br><span class=\"line\">\t&lt;body&gt;</span><br><span class=\"line\">\t&lt;<span class=\"regexp\">/body&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">&lt;/</span>html&gt;</span><br></pre></td></tr></table></div></figure>\n<ul>\n<li>02.php</li>\n</ul>\n<figure class=\"highlight php\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"string\">'我是同步方式的'</span>;</span><br><span class=\"line\">sleep(<span class=\"number\">10</span>);</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></div></figure>\n<p>大家可以在控制台看一下，等到10秒之后才会在控制台输出“我是同步消息”这句话，也就是说以同步的方式发送消息，客户端会一直在等待服务器做出响应，这样的效率会很低。</p>\n<p>注意：有关于php的代码只有在php中运行才会有效，在测试前应该配置好基本的环境。</p>\n<h2 id=\"3-XMLHttpRequest传递数据\">3.XMLHttpRequest传递数据<a href=\"2018/07/12/浅谈ajax#3-XMLHttpRequest传递数据\"></a></h2><figure class=\"highlight javascript\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">\t&lt;head&gt;</span><br><span class=\"line\">\t\t&lt;meta charset=<span class=\"string\">\"UTF-8\"</span>&gt;</span><br><span class=\"line\">\t\t&lt;title&gt;&lt;/title&gt;</span><br><span class=\"line\">\t\t&lt;script&gt;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">var</span> xhr=<span class=\"keyword\">new</span> XMLHttpRequest;</span><br><span class=\"line\">\t\t\txhr.open(<span class=\"string\">\"get\"</span>,<span class=\"string\">\"03.php?name=yang\"</span>)</span><br><span class=\"line\">\t\t\txhr.setRequestHeader(<span class=\"string\">\"Content-Type\"</span>,<span class=\"string\">\"text/html\"</span>);</span><br><span class=\"line\">\t\t\txhr.send(<span class=\"literal\">null</span>);</span><br><span class=\"line\">\t\t\txhr.onreadystatechange=<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span>(xhr.readyState==<span class=\"number\">4</span>&amp;&amp; xhr.status==<span class=\"number\">200</span>)&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">var</span> result=xhr.responseText;</span><br><span class=\"line\">                     <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"result\"</span>).innerHTML=result;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"built_in\">console</span>.log(result);</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&lt;<span class=\"regexp\">/script&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">\t&lt;/</span>head&gt;</span><br><span class=\"line\">\t&lt;body&gt;</span><br><span class=\"line\">\t\t&lt;p id=<span class=\"string\">\"result\"</span>&gt;&lt;/p&gt;</span><br><span class=\"line\">\t&lt;<span class=\"regexp\">/body&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">&lt;/</span>html&gt;</span><br></pre></td></tr></table></div></figure>\n<ul>\n<li>03.php</li>\n</ul>\n<figure class=\"highlight php\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">echo</span> $_GET[<span class=\"string\">'name'</span>];</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></div></figure>\n<p>运行结果：很明显在客户端已经获取到了这样的结果</p>\n<p><img src=\"http://images.cnblogs.com/cnblogs_com/cliy-10/1240733/o_6.png\" alt=\" \" class=\"article-img\"></p>\n<p>大家是不是很好奇为什么传递数据为什么要是这样的形式？把要传递的参数写在请求资源的后面。</p>\n<p><code>xhr.open(&quot;get&quot;,&quot;03.php?name=yang&quot;)</code></p>\n<p>原因：因为在get的请求方式中，浏览器在默认情况下就是把参数放在URL后面的,我们要遵从浏览器的默认行为。</p>\n<p>那如果以post的方式该怎么传递数据呢？肯定是和get的方式有些区别的。</p>\n<p>以post的形式的话，传递的数据是放在<code>send()</code>方法中的。</p>\n<p>注意：当以post形式提交表单的时候，请求头里会设置<code>Content-Type:application/x-www-form-urlencoded</code>，以get形式时不需要请求主体。</p>\n<figure class=\"highlight javascript\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">\t&lt;head&gt;</span><br><span class=\"line\">\t\t&lt;meta charset=<span class=\"string\">\"UTF-8\"</span>&gt;</span><br><span class=\"line\">\t\t&lt;title&gt;&lt;/title&gt;</span><br><span class=\"line\">\t\t&lt;script&gt;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">var</span> xhr=<span class=\"keyword\">new</span> XMLHttpRequest;</span><br><span class=\"line\">\t\t\txhr.open(<span class=\"string\">\"post\"</span>,<span class=\"string\">\"04.php\"</span>)</span><br><span class=\"line\">\t\t\txhr.setRequestHeader(<span class=\"string\">\"Content-Type\"</span>,<span class=\"string\">\"application/x-www-form-urlencoded\"</span>);</span><br><span class=\"line\">\t\t\txhr.send(<span class=\"string\">\"name=yang&amp;age=18\"</span>);</span><br><span class=\"line\">\t\t\txhr.onreadystatechange=<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span>(xhr.readyState==<span class=\"number\">4</span>&amp;&amp; xhr.status==<span class=\"number\">200</span>)&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">var</span> result=xhr.responseText;</span><br><span class=\"line\">                     <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"result\"</span>).innerHTML=result;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"built_in\">console</span>.log(result);</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&lt;<span class=\"regexp\">/script&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">\t&lt;/</span>head&gt;</span><br><span class=\"line\">\t&lt;body&gt;</span><br><span class=\"line\">\t\t&lt;p id=<span class=\"string\">\"result\"</span>&gt;&lt;/p&gt;</span><br><span class=\"line\">\t&lt;<span class=\"regexp\">/body&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">&lt;/</span>html&gt;</span><br></pre></td></tr></table></div></figure>\n<ul>\n<li>04.php</li>\n</ul>\n<figure class=\"highlight php\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">echo</span> $_POST[<span class=\"string\">'name'</span>].$_POST[<span class=\"string\">'age'</span>];</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></div></figure>\n<p>运行结果：<img src=\"http://images.cnblogs.com/cnblogs_com/cliy-10/1240733/o_7.png\" alt=\" \"></p>\n<h2 id=\"4-XMLHttpRequest实现局部更新功能-表单事件提交\">4.XMLHttpRequest实现局部更新功能(表单事件提交)<a href=\"2018/07/12/浅谈ajax#4-XMLHttpRequest实现局部更新功能-表单事件提交\"></a></h2><figure class=\"highlight javascript\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">\t&lt;head&gt;</span><br><span class=\"line\">\t\t&lt;meta charset=<span class=\"string\">\"UTF-8\"</span>&gt;</span><br><span class=\"line\">\t\t&lt;title&gt;&lt;/title&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">\t&lt;<span class=\"regexp\">/head&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">\t&lt;body&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t&lt;input type=\"text\" id=\"text\" /</span>&gt;</span><br><span class=\"line\">\t\t&lt;input type=<span class=\"string\">\"submit\"</span> value=<span class=\"string\">\"发送\"</span> id=<span class=\"string\">\"sub\"</span> /&gt;</span><br><span class=\"line\">\t\t&lt;p id=<span class=\"string\">\"result\"</span>&gt;&lt;/p&gt;</span><br><span class=\"line\">\t\t&lt;script&gt;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">var</span> btn = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"sub\"</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">var</span> test = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"text\"</span>);</span><br><span class=\"line\">\t\t\tbtn.addEventListener(<span class=\"string\">'click'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">//点击的时候才去实例化XMLHttpRequest，而不是加载的时候实例化XMLHttpRequest</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">var</span> xhr = <span class=\"keyword\">new</span> XMLHttpRequest;</span><br><span class=\"line\">\t\t\t\txhr.open(<span class=\"string\">\"post\"</span>, <span class=\"string\">\"05.php\"</span>);</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">//因为是post请求的方式，所以一定要设置Content-Type</span></span><br><span class=\"line\">\t\t\t\txhr.setRequestHeader(<span class=\"string\">\"Content-Type\"</span>, <span class=\"string\">\"application/x-www-form-urlencoded\"</span>);</span><br><span class=\"line\">\t\t\t\txhr.send(<span class=\"string\">'text='</span> + test.value);</span><br><span class=\"line\">\t\t\t\txhr.onreadystatechange = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span>(xhr.readyState == <span class=\"number\">4</span> &amp;&amp; xhr.status == <span class=\"number\">200</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">var</span> result = xhr.responseText;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"result\"</span>).innerHTML = result;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"built_in\">console</span>.log(result);</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;)</span><br><span class=\"line\">\t\t&lt;<span class=\"regexp\">/script&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">\t&lt;/</span>body&gt;</span><br><span class=\"line\">&lt;<span class=\"regexp\">/html&gt;</span></span><br></pre></td></tr></table></div></figure>\n<ul>\n<li>05.php</li>\n</ul>\n<figure class=\"highlight php\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"string\">'&lt;strong&gt;'</span>.$_POST[<span class=\"string\">'text'</span>].<span class=\"string\">'&lt;/strong&gt;'</span>;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></div></figure>\n<p>运行结果</p>\n<p><img src=\"http://images.cnblogs.com/cnblogs_com/cliy-10/1240733/o_8.png\" alt=\" \" class=\"article-img\"></p>\n<p>那我们来看一个小案例吧。</p>\n<figure class=\"highlight javascript\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html lang=<span class=\"string\">\"en\"</span>&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">\t&lt;meta charset=<span class=\"string\">\"UTF-8\"</span>&gt;</span><br><span class=\"line\">\t&lt;title&gt;Ajax&lt;<span class=\"regexp\">/title&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">\t&lt;style&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\tbody &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\tmargin: 0;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\tpadding: 0;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\tbackground-color: #F7F7F7;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t.chatbox &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\twidth: 500px;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\theight: 500px;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\tmargin: 0 auto;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\tborder: 1px solid #CCC;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\tbackground-color: #FFF;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\tborder-radius: 5px;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t.messages &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\theight: 350px;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\tpadding: 20px 40px;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\tbox-sizing: border-box;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\tborder-bottom: 1px solid #CCC;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\toverflow: scroll;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t.messages h5 &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\tfont-size: 20px;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\tmargin: 10px 0;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t.messages p &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\tfont-size: 18px;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\tmargin: 0;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t.self &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\ttext-align: left;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t.other &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\ttext-align: right;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t.form &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\theight: 150px;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t.form .input &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\theight: 110px;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\tpadding: 10px;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\tbox-sizing: border-box;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t.form .btn &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\theight: 40px;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\tbox-sizing: border-box;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\tborder-top: 1px solid #CCC;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t.form textarea &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\tdisplay: block;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\twidth: 100%;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\theight: 100%;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\tbox-sizing: border-box;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\tborder: none;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\tresize: none;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\toutline: none;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\tfont-size: 20px;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t.form input &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\tdisplay: block;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\twidth: 100px;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\theight: 30px;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\tmargin-top: 5px;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\tmargin-right: 20px;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\tfloat: right;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"regexp\">\t&lt;/</span>style&gt;</span><br><span class=\"line\">&lt;<span class=\"regexp\">/head&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">&lt;body&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">\t&lt;div class=\"chatbox\"&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t&lt;div class=\"messages\"&gt;\t</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t&lt;/</span>div&gt;</span><br><span class=\"line\">\t\t&lt;div <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"form\"</span>&gt;</span><br><span class=\"line\">\t\t\t&lt;div <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"input\"</span>&gt;</span><br><span class=\"line\">\t\t\t\t&lt;textarea&gt;&lt;/textarea&gt;</span><br><span class=\"line\">\t\t\t&lt;<span class=\"regexp\">/div&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\t&lt;div class=\"btn\"&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\t\t&lt;input type=\"button\" value=\"发送\"&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">\t\t\t&lt;/</span>div&gt;</span><br><span class=\"line\">\t\t&lt;<span class=\"regexp\">/div&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">\t&lt;/</span>div&gt;</span><br><span class=\"line\">\t&lt;!--&lt;script type=\"text/template\"&gt;</span><br><span class=\"line\">\t\t&lt;div class=\"item self\"&gt;</span><br><span class=\"line\">\t\t\t&lt;h5&gt;我说&lt;/h5&gt;</span><br><span class=\"line\">\t\t\t&lt;p&gt;你好&lt;/p&gt;</span><br><span class=\"line\">\t\t&lt;/div&gt;</span><br><span class=\"line\">\t\t&lt;div class=\"item other\"&gt;</span><br><span class=\"line\">\t\t\t&lt;h5&gt;对方说&lt;/h5&gt;</span><br><span class=\"line\">\t\t\t&lt;p&gt;你好&lt;/p&gt;</span><br><span class=\"line\">\t\t&lt;/div&gt;</span><br><span class=\"line\">\t&lt;/script&gt;--&gt;</span><br><span class=\"line\">\t&lt;script&gt;</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> btn = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'.btn'</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> message = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'.messages'</span>);</span><br><span class=\"line\">\t\tbtn.onclick = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">var</span> xhr = <span class=\"keyword\">new</span> XMLHttpRequest;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 获取表单的DOM节点</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">var</span> input = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'textarea'</span>);</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 获取文本内容</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">var</span> val = input.value;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 通过一函数创建并接凑DOM节点</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">var</span> item = createMessage(<span class=\"string\">'self'</span>, val);</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 将创建完成的DOM节点追加到消息盒子里</span></span><br><span class=\"line\">\t\t\tmessage.appendChild(item);</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 置空表单</span></span><br><span class=\"line\">\t\t\tinput.value = <span class=\"string\">''</span>;</span><br><span class=\"line\">\t\t\t]</span><br><span class=\"line\">\t\t\t<span class=\"comment\">/******************以下是Ajax*******************/</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 发起请求</span></span><br><span class=\"line\">\t\t\txhr.open(<span class=\"string\">'post'</span>, <span class=\"string\">'chat.php'</span>);</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 设置请求头</span></span><br><span class=\"line\">\t\t\txhr.setRequestHeader(<span class=\"string\">'Content-Type'</span>, <span class=\"string\">'application/x-www-form-urlencoded'</span>);</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 发送到服务器</span></span><br><span class=\"line\">\t\t\txhr.send(<span class=\"string\">'message='</span> + val);</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 监听并处理响应</span></span><br><span class=\"line\">\t\t\txhr.onreadystatechange = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span>(xhr.readyState == <span class=\"number\">4</span> &amp;&amp; xhr.status == <span class=\"number\">200</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"comment\">// 接收返回的消息</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">var</span> result = xhr.responseText;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"comment\">// 通过一函数创建并接凑DOM节点</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">var</span> item = createMessage(<span class=\"string\">'other'</span>, result);</span><br><span class=\"line\">\t\t\t\t\t<span class=\"comment\">// 将接凑好的DOM节点追加到消息盒子里</span></span><br><span class=\"line\">\t\t\t\t\tmessage.appendChild(item);</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"comment\">// 动态创建DOM</span></span><br><span class=\"line\">\t\t<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createMessage</span>(<span class=\"params\">flag, text</span>) </span>&#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 创建结点</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">var</span> item = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'div'</span>),</span><br><span class=\"line\">\t\t\t\th5 = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'h5'</span>),</span><br><span class=\"line\">\t\t\t\tp = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'p'</span>);</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 添加类</span></span><br><span class=\"line\">\t\t\titem.classList.add(<span class=\"string\">'item'</span>);</span><br><span class=\"line\">\t\t\titem.classList.add(flag);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 判断主体</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">switch</span>(flag) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">case</span> <span class=\"string\">'self'</span>:</span><br><span class=\"line\">\t\t\t\t\th5.innerText = <span class=\"string\">'我说'</span>;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">case</span> <span class=\"string\">'other'</span>:</span><br><span class=\"line\">\t\t\t\t\th5.innerText = <span class=\"string\">'对方说'</span>;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 插入文本</span></span><br><span class=\"line\">\t\t\tp.innerText = text;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 追加节点</span></span><br><span class=\"line\">\t\t\titem.appendChild(h5);</span><br><span class=\"line\">\t\t\titem.appendChild(p);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> item;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&lt;<span class=\"regexp\">/script&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">&lt;/</span>body&gt;</span><br><span class=\"line\">&lt;<span class=\"regexp\">/html&gt;</span></span><br></pre></td></tr></table></div></figure>\n<ul>\n<li>chat.php</li>\n</ul>\n<figure class=\"highlight php\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">\t$messages = <span class=\"keyword\">array</span>(</span><br><span class=\"line\">\t\t<span class=\"string\">'你说啥？'</span>,</span><br><span class=\"line\">\t\t<span class=\"string\">'你也好'</span>,</span><br><span class=\"line\">\t\t<span class=\"string\">'你找我有啥事？'</span>,</span><br><span class=\"line\">\t\t<span class=\"string\">'我在吃饭！'</span></span><br><span class=\"line\">\t);</span><br><span class=\"line\">\t<span class=\"comment\">// 通过array_rand()随机获取数组下标</span></span><br><span class=\"line\">\t<span class=\"comment\">// var_dump(array_rand($messages));</span></span><br><span class=\"line\">\t<span class=\"keyword\">echo</span> $messages[array_rand($messages)];</span><br><span class=\"line\">\tsleep(<span class=\"number\">1</span>);</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></div></figure>\n<p><img src=\"http://images.cnblogs.com/cnblogs_com/cliy-10/1240733/o_9.png\" alt=\" \" class=\"article-img\"></p>\n<h2 id=\"5-简单的总结\">5.简单的总结<a href=\"2018/07/12/浅谈ajax#5-简单的总结\"></a></h2><p><code>XMLHttpRequest</code>：浏览器内建对象，用于在后台与服务器通信(交换数据) ，由此我们便可实现对网页的部分更新，而不是刷新整个页面。</p>\n<p>下面是一个简单的例子：</p>\n<p><img src=\"http://images.cnblogs.com/cnblogs_com/cliy-10/1240733/o_10.png\" alt=\" \" class=\"article-img\"></p>\n<p>由于XMLHttpRequest本质基于HTTP协议实现通信，所以结合HTTP协议和上面的例子我们分析得出如下结果：</p>\n<h3 id=\"5-1-请求\">5.1.请求<a href=\"2018/07/12/浅谈ajax#5-1-请求\"></a></h3><p>HTTP请求3个组成部分与XMLHttpRequest方法的对应关系</p>\n<ul>\n<li>请求行</li>\n</ul>\n<p><img src=\"http://images.cnblogs.com/cnblogs_com/cliy-10/1240733/o_11.png\" alt=\" \" class=\"article-img\"></p>\n<ul>\n<li>请求头</li>\n</ul>\n<p><img src=\"http://images.cnblogs.com/cnblogs_com/cliy-10/1240733/o_12.png\" alt=\" \" class=\"article-img\"></p>\n<p>get请求可以不设置</p>\n<ul>\n<li>请求主体</li>\n</ul>\n<p><img src=\"http://images.cnblogs.com/cnblogs_com/cliy-10/1240733/o_13.png\" alt=\" \" class=\"article-img\"></p>\n<p>注意书写顺序</p>\n<h3 id=\"5-2-响应\">5.2.响应<a href=\"2018/07/12/浅谈ajax#5-2-响应\"></a></h3><p>HTTP响应是由服务端发出的，作为客户端更应关心的是响应的结果。</p>\n<p>HTTP响应3个组成部分与XMLHttpRequest方法或属性的对应关系。</p>\n<p>由于服务器做出响应需要时间（比如网速慢等原因），所以我们需要监听服务器响应的状态，然后才能进行处理。</p>\n<p><img src=\"http://images.cnblogs.com/cnblogs_com/cliy-10/1240733/o_14.png\" alt=\" \" class=\"article-img\"></p>\n<p><code>onreadystatechange</code>是Javascript的事件的一种，其意义在于监听<code>XMLHttpRequest</code>的状态。</p>\n<ul>\n<li>获取状态行（包括状态码&amp;状态信息）</li>\n</ul>\n<p><img src=\"http://images.cnblogs.com/cnblogs_com/cliy-10/1240733/o_15.png\" alt=\" \" class=\"article-img\"></p>\n<ul>\n<li>获取响应头</li>\n</ul>\n<p><img src=\"http://images.cnblogs.com/cnblogs_com/cliy-10/1240733/o_16.png\" alt=\" \" class=\"article-img\"></p>\n<ul>\n<li>响应主体</li>\n</ul>\n<p><img src=\"http://images.cnblogs.com/cnblogs_com/cliy-10/1240733/o_17.png\" alt=\" \" class=\"article-img\"></p>\n<p>我们需要检测并判断响应头的MIME类型后确定使用<code>request.responseText</code>或者<code>request.responseXML</code></p>\n<h3 id=\"5-3-API详解\">5.3.API详解<a href=\"2018/07/12/浅谈ajax#5-3-API详解\"></a></h3><ul>\n<li><p>xhr.open() 发起请求，可以是get、post方式</p>\n</li>\n<li><p>xhr.setRequestHeader() 设置请求头</p>\n</li>\n<li><p>xhr.send() 发送请求主体get方式使用xhr.send(null)</p>\n</li>\n<li><p>xhr.onreadystatechange = function () {} 监听响应状态</p>\n</li>\n<li><p>xhr.readyState = 0时，UNSENT open尚未调用</p>\n</li>\n<li><p>xhr.readyState = 1时，OPENED open已调用</p>\n</li>\n<li><p>xhr.readyState = 2时，HEADERS_RECEIVED 接收到头信息</p>\n</li>\n<li><p>xhr.readyState = 3时，LOADING 接收到响应主体</p>\n</li>\n<li><p>xhr.readyState = 4时，DONE 响应完成</p>\n</li>\n<li><p>xhr.status表示响应码，</p>\n</li>\n<li><p>xhr.statusText表示响应信息，</p>\n</li>\n<li><p>xhr.getAllResponseHeaders() 获取全部响应头信息</p>\n</li>\n<li><p>xhr.getResponseHeader(‘key’) 获取指定头信息</p>\n</li>\n<li><p>xhr.responseText、xhr.responseXML都表示响应主体</p>\n</li>\n</ul>\n<p>注意：GET和POST请求方式的差异（面试题）</p>\n<ul>\n<li><p>GET没有请求主体，使用xhr.send(null)</p>\n</li>\n<li><p>GET可以通过在请求URL上添加请求参数</p>\n</li>\n<li><p>POST可以通过xhr.send<code>(&#39;name=itcast&amp;age=10&#39;)</code>[键值对的形式]</p>\n</li>\n<li><p>POST需要设置请求头：</p>\n</li>\n</ul>\n<figure class=\"highlight javascript\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xhr.setRequestHeader(<span class=\"string\">'Content-Type'</span>, <span class=\"string\">'application/x-www-form-urlencoded'</span>);</span><br></pre></td></tr></table></div></figure>\n<h3 id=\"5-4-GET效率更好（应用多）\">5.4.GET效率更好（应用多）<a href=\"2018/07/12/浅谈ajax#5-4-GET效率更好（应用多）\"></a></h3><h3 id=\"5-5-GET大小限制约4K，POST则没有限制。\">5.5.GET大小限制约4K，POST则没有限制。<a href=\"2018/07/12/浅谈ajax#5-5-GET大小限制约4K，POST则没有限制。\"></a></h3><h2 id=\"6-XML数据VSJSON数据\">6.XML数据VSJSON数据<a href=\"2018/07/12/浅谈ajax#6-XML数据VSJSON数据\"></a></h2><p>问题：如何获取复杂数据呢？利用XML或者JSON，现在大多数情况下用的是JSON。我们可以先来看一下XML。</p>\n<h3 id=\"6-1-XML数据\">6.1.XML数据<a href=\"2018/07/12/浅谈ajax#6-1-XML数据\"></a></h3><p>XML是一种标记语言，很类似HTML，其宗旨是用来传输数据，具有自我描述性（固定的格式的数据）。</p>\n<p><img src=\"http://images.cnblogs.com/cnblogs_com/cliy-10/1240733/o_18.png\" alt=\" \" class=\"article-img\"></p>\n<p>语法规则</p>\n<ul>\n<li><p>必须有一个根元素</p>\n</li>\n<li><p>不可有空格、不可以数字或.开头、大小写敏感</p>\n</li>\n<li><p>不可交叉嵌套</p>\n</li>\n<li><p>属性双引号（浏览器自动修正成双引号了）</p>\n</li>\n<li><p>特殊符号要使用实体</p>\n</li>\n<li><p>注释和HTML一样</p>\n</li>\n</ul>\n<p>虽然可以描述和传输复杂数据，但是其解析过于复杂并且体积较大，所以实现开发已经很少使用了。</p>\n<p>下面是一个关于XML的小案例</p>\n<ul>\n<li>index.html</li>\n</ul>\n<figure class=\"highlight plain\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html lang=&quot;en&quot;&gt;</span><br><span class=\"line\">\t&lt;head&gt;</span><br><span class=\"line\">\t\t&lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class=\"line\">\t\t&lt;title&gt;XML&lt;/title&gt;</span><br><span class=\"line\">\t\t&lt;style&gt;</span><br><span class=\"line\">\t\t\ttable &#123;</span><br><span class=\"line\">\t\t\t\twidth: 300px;</span><br><span class=\"line\">\t\t\t\tborder-collapse: collapse;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\ttd &#123;</span><br><span class=\"line\">\t\t\t\theight: 40px;</span><br><span class=\"line\">\t\t\t\ttext-align: center;</span><br><span class=\"line\">\t\t\t\tborder: 1px solid #CCC;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&lt;/style&gt;</span><br><span class=\"line\">\t&lt;/head&gt;</span><br><span class=\"line\">\t&lt;body&gt;</span><br><span class=\"line\">\t\t&lt;table&gt;</span><br><span class=\"line\">\t\t&lt;/table&gt;</span><br><span class=\"line\">\t\t&lt;div class=&quot;btn&quot;&gt;&lt;input type=&quot;button&quot; value=&quot;获取数据&quot;&gt;&lt;/div&gt;</span><br><span class=\"line\">\t\t&lt;script&gt;</span><br><span class=\"line\">\t\t\tvar btn = document.querySelector(&apos;.btn&apos;);</span><br><span class=\"line\">\t\t\tbtn.onclick = function() &#123;</span><br><span class=\"line\">\t\t\t\tvar xhr = new XMLHttpRequest;</span><br><span class=\"line\">\t\t\t\txhr.open(&apos;get&apos;, &apos;stars.php&apos;);</span><br><span class=\"line\">\t\t\t\txhr.send(null);</span><br><span class=\"line\">\t\t\t\txhr.onreadystatechange = function() &#123;</span><br><span class=\"line\">\t\t\t\t\tif(xhr.readyState == 4 &amp;&amp; xhr.status == 200) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t// 一个新的属性，用来接收XML格式的数据</span><br><span class=\"line\">\t\t\t\t\t\tvar result = xhr.responseXML;</span><br><span class=\"line\">\t\t\t\t\t\t// console.log(result);</span><br><span class=\"line\">\t\t\t\t\t\t//解析XML文档的内容</span><br><span class=\"line\">\t\t\t\t\t\tvar items = result.getElementsByTagName(&apos;root&apos;)[0];</span><br><span class=\"line\">\t\t\t\t\t\t//console.log(items);</span><br><span class=\"line\">\t\t\t\t\t\tvar item = items.getElementsByTagName(&apos;item&apos;);</span><br><span class=\"line\">\t\t\t\t\t\t //console.log(item);</span><br><span class=\"line\">\t\t\t\t\t\t //&lt;item&gt;的子元素有多少个，就循环遍历几次(4)</span><br><span class=\"line\">\t\t\t\t\t\tvar html = &apos;&apos;;</span><br><span class=\"line\">\t\t\t\t\t\tfor(var i = 0; i &lt; item.length; i++) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\tvar name = item[i].getElementsByTagName(&apos;name&apos;)[0];</span><br><span class=\"line\">\t\t\t\t\t\t\tvar photo = item[i].getElementsByTagName(&apos;photo&apos;)[0];</span><br><span class=\"line\">\t\t\t\t\t\t\tvar album = item[i].getElementsByTagName(&apos;album&apos;)[0];</span><br><span class=\"line\">\t\t\t\t\t\t\tvar age = item[i].getElementsByTagName(&apos;age&apos;)[0];</span><br><span class=\"line\">\t\t\t\t\t\t\tvar sex = item[i].getElementsByTagName(&apos;sex&apos;)[0];</span><br><span class=\"line\">\t\t\t\t\t\t\tvar nameText = name.firstChild.nodeValue;</span><br><span class=\"line\">\t\t\t\t\t\t\tvar photoText = photo.firstChild.nodeValue;</span><br><span class=\"line\">\t\t\t\t\t\t\tvar albumText = album.firstChild.nodeValue;</span><br><span class=\"line\">\t\t\t\t\t\t\tvar ageText = age.firstChild.nodeValue;</span><br><span class=\"line\">\t\t\t\t\t\t\tvar sexText = sex.firstChild.nodeValue;</span><br><span class=\"line\">\t\t\t\t\t\t\thtml += &apos;&lt;tr&gt;&apos;;</span><br><span class=\"line\">\t\t\t\t\t\t\thtml += &apos;&lt;td&gt;&apos; + nameText + &apos;&lt;/td&gt;&apos;;</span><br><span class=\"line\">\t\t\t\t\t\t\thtml += &apos;&lt;td&gt;&apos; + albumText + &apos;&lt;/td&gt;&apos;;</span><br><span class=\"line\">\t\t\t\t\t\t\thtml += &apos;&lt;td&gt;&apos; + ageText + &apos;&lt;/td&gt;&apos;;</span><br><span class=\"line\">\t\t\t\t\t\t\thtml += &apos;&lt;td&gt;&apos; + sexText + &apos;&lt;/td&gt;&apos;;</span><br><span class=\"line\">\t\t\t\t\t\t\thtml += &apos;&lt;/tr&gt;&apos;;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t\tdocument.querySelector(&apos;table&apos;).innerHTML = html;</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&lt;/script&gt;</span><br><span class=\"line\">\t&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></div></figure>\n<ul>\n<li>stars.php</li>\n</ul>\n<figure class=\"highlight php\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">\t<span class=\"comment\">// 指定文档类型</span></span><br><span class=\"line\">\theader(<span class=\"string\">'Content-Type:text/xml; charset=utf-8'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t$result = file_get_contents(<span class=\"string\">'stars.xml'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">echo</span> $result;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></div></figure>\n<ul>\n<li>stars.xml</li>\n</ul>\n<figure class=\"highlight plain\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;root&gt;</span><br><span class=\"line\">\t&lt;item&gt;</span><br><span class=\"line\">\t\t&lt;name type=&quot;star&quot;&gt;王力宏&lt;/name&gt;</span><br><span class=\"line\">\t\t&lt;photo&gt;./images/wlh.jpg&lt;/photo&gt;</span><br><span class=\"line\">\t\t&lt;album&gt;&amp;lt;&amp;lt;改变自已&amp;gt;&amp;gt;&lt;/album&gt;</span><br><span class=\"line\">\t\t&lt;age&gt;39&lt;/age&gt;</span><br><span class=\"line\">\t\t&lt;sex&gt;男&lt;/sex&gt;</span><br><span class=\"line\">\t&lt;/item&gt;</span><br><span class=\"line\">\t&lt;item&gt;</span><br><span class=\"line\">\t\t&lt;name type=&quot;star&quot;&gt;周杰伦&lt;/name&gt;</span><br><span class=\"line\">\t\t&lt;photo&gt;./images/wlh.jpg&lt;/photo&gt;</span><br><span class=\"line\">\t\t&lt;album&gt;&amp;lt;&amp;lt;我很忙&amp;gt;&amp;gt;&lt;/album&gt;</span><br><span class=\"line\">\t\t&lt;age&gt;39&lt;/age&gt;</span><br><span class=\"line\">\t\t&lt;sex&gt;男&lt;/sex&gt;</span><br><span class=\"line\">\t&lt;/item&gt;</span><br><span class=\"line\">\t&lt;item&gt;</span><br><span class=\"line\">\t\t&lt;name type=&quot;star&quot;&gt;王力宏&lt;/name&gt;</span><br><span class=\"line\">\t\t&lt;photo&gt;./images/wlh.jpg&lt;/photo&gt;</span><br><span class=\"line\">\t\t&lt;album&gt;&amp;lt;&amp;lt;改变自已&amp;gt;&amp;gt;&lt;/album&gt;</span><br><span class=\"line\">\t\t&lt;age&gt;39&lt;/age&gt;</span><br><span class=\"line\">\t\t&lt;sex&gt;男&lt;/sex&gt;</span><br><span class=\"line\">\t&lt;/item&gt;</span><br><span class=\"line\">\t&lt;item&gt;</span><br><span class=\"line\">\t\t&lt;name type=&quot;star&quot;&gt;王力宏&lt;/name&gt;</span><br><span class=\"line\">\t\t&lt;photo&gt;./images/wlh.jpg&lt;/photo&gt;</span><br><span class=\"line\">\t\t&lt;album&gt;&amp;lt;&amp;lt;改变自已&amp;gt;&amp;gt;&lt;/album&gt;</span><br><span class=\"line\">\t\t&lt;age&gt;39&lt;/age&gt;</span><br><span class=\"line\">\t\t&lt;sex&gt;男&lt;/sex&gt;</span><br><span class=\"line\">\t&lt;/item&gt;</span><br><span class=\"line\">&lt;/root&gt;</span><br></pre></td></tr></table></div></figure>\n<p>运行结果：<img src=\"http://images.cnblogs.com/cnblogs_com/cliy-10/1240733/t_19.png\" alt=\" \"></p>\n<p>大家可以看出来真的是用xml来表示比较复杂的数据时，解析数据时真的是超级麻烦并且文档体积也很大。我们可以用JSON来表示复杂的数据，解析数据的时候也较为简单。</p>\n<h3 id=\"6-2-JSON：即JavaScript-Object-Notation，另一种轻量级的文本数据交换格式，独立于语言。\">6.2.JSON：即JavaScript Object Notation，另一种轻量级的文本数据交换格式，独立于语言。<a href=\"2018/07/12/浅谈ajax#6-2-JSON：即JavaScript-Object-Notation，另一种轻量级的文本数据交换格式，独立于语言。\"></a></h3><p>语法规则：</p>\n<ul>\n<li><p>数据在名称/值对中</p>\n</li>\n<li><p>数据由逗号分隔(最后一个健/值对不能带逗号)</p>\n</li>\n<li><p>花括号保存对象方括号保存数组</p>\n</li>\n<li><p>使用双引号</p>\n</li>\n</ul>\n<p>我们可以看下JSON解析数据的时候是否也和XML解析数据时一样复杂？</p>\n<ul>\n<li>index.html</li>\n</ul>\n<figure class=\"highlight plain\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html lang=&quot;en&quot;&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">\t&lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class=\"line\">\t&lt;title&gt;JSON&lt;/title&gt;</span><br><span class=\"line\">\t&lt;style&gt;</span><br><span class=\"line\">\t\ttable &#123;</span><br><span class=\"line\">\t\t\twidth: 300px;</span><br><span class=\"line\">\t\t\tborder-collapse: collapse;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\ttd &#123;</span><br><span class=\"line\">\t\t\theight: 40px;</span><br><span class=\"line\">\t\t\ttext-align: center;</span><br><span class=\"line\">\t\t\tborder: 1px solid #CCC;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&lt;/style&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">\t&lt;table&gt;</span><br><span class=\"line\">\t&lt;/table&gt;</span><br><span class=\"line\">\t&lt;div class=&quot;btn&quot;&gt;&lt;input type=&quot;button&quot; value=&quot;获取数据&quot;&gt;&lt;/div&gt;</span><br><span class=\"line\">\t&lt;script&gt;</span><br><span class=\"line\">\t\tvar btn = document.querySelector(&apos;.btn&apos;);</span><br><span class=\"line\">\t\tbtn.onclick = function () &#123;</span><br><span class=\"line\">\t\t\tvar xhr = new XMLHttpRequest;</span><br><span class=\"line\">\t\t\txhr.open(&apos;get&apos;, &apos;stars.php&apos;);</span><br><span class=\"line\">\t\t\txhr.send(null);</span><br><span class=\"line\">\t\t\txhr.onreadystatechange = function () &#123;</span><br><span class=\"line\">\t\t\t\tif(xhr.readyState == 4 &amp;&amp; xhr.status == 200) &#123;</span><br><span class=\"line\">\t\t\t\t\tvar result = xhr.responseText;</span><br><span class=\"line\">\t\t\t\t\tconsole.log(typeof(result));</span><br><span class=\"line\">\t\t\t\t\t//将JSON格式的字符串类型转化为JavaScript对象</span><br><span class=\"line\">\t\t\t\t\tvar data = JSON.parse(result);</span><br><span class=\"line\">\t\t\t\t\tconsole.log(data);</span><br><span class=\"line\">\t\t\t\t\tvar html = &apos;&apos;;</span><br><span class=\"line\">\t\t\t\t\tfor(var i=0; i&lt;data.length; i++) &#123;</span><br><span class=\"line\">\t\t\t\t\t\thtml += &apos;&lt;tr&gt;&apos;;</span><br><span class=\"line\">\t\t\t\t\t\thtml += &apos;&lt;td&gt;&apos; + data[i].name + &apos;&lt;/td&gt;&apos;;</span><br><span class=\"line\">\t\t\t\t\t\thtml += &apos;&lt;td&gt;&apos; + data[i].ablum + &apos;&lt;/td&gt;&apos;;</span><br><span class=\"line\">\t\t\t\t\t\thtml += &apos;&lt;td&gt;&apos; + data[i].age + &apos;&lt;/td&gt;&apos;;</span><br><span class=\"line\">\t\t\t\t\t\thtml += &apos;&lt;td&gt;&apos; + data[i].sex + &apos;&lt;/td&gt;&apos;;</span><br><span class=\"line\">\t\t\t\t\t\thtml += &apos;&lt;/tr&gt;&apos;;</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\tdocument.querySelector(&apos;table&apos;).innerHTML = html;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&lt;/script&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></div></figure>\n<ul>\n<li>stars.json</li>\n</ul>\n<figure class=\"highlight plain\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t&quot;name&quot;: &quot;王力宏&quot;,</span><br><span class=\"line\">\t\t&quot;photo&quot;: &quot;./images/wlh.jpg&quot;,</span><br><span class=\"line\">\t\t&quot;ablum&quot;: &quot;&lt;&lt;改变自已&gt;&gt;&quot;,</span><br><span class=\"line\">\t\t&quot;age&quot;: 39,</span><br><span class=\"line\">\t\t&quot;sex&quot;: &quot;男&quot;</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t&quot;name&quot;: &quot;王力宏&quot;,</span><br><span class=\"line\">\t\t&quot;photo&quot;: &quot;./images/wlh.jpg&quot;,</span><br><span class=\"line\">\t\t&quot;ablum&quot;: &quot;&lt;&lt;改变自已&gt;&gt;&quot;,</span><br><span class=\"line\">\t\t&quot;age&quot;: 39,</span><br><span class=\"line\">\t\t&quot;sex&quot;: &quot;男&quot;</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t&quot;name&quot;: &quot;王力宏&quot;,</span><br><span class=\"line\">\t\t&quot;photo&quot;: &quot;./images/wlh.jpg&quot;,</span><br><span class=\"line\">\t\t&quot;ablum&quot;: &quot;&lt;&lt;改变自已&gt;&gt;&quot;,</span><br><span class=\"line\">\t\t&quot;age&quot;: 39,</span><br><span class=\"line\">\t\t&quot;sex&quot;: &quot;男&quot;</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t&quot;name&quot;: &quot;王力宏&quot;,</span><br><span class=\"line\">\t\t&quot;photo&quot;: &quot;./images/wlh.jpg&quot;,</span><br><span class=\"line\">\t\t&quot;ablum&quot;: &quot;&lt;&lt;改变自已&gt;&gt;&quot;,</span><br><span class=\"line\">\t\t&quot;age&quot;: 39,</span><br><span class=\"line\">\t\t&quot;sex&quot;: &quot;男&quot;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></div></figure>\n<ul>\n<li>stars.php</li>\n</ul>\n<figure class=\"highlight plain\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">\t// 指定文档类型</span><br><span class=\"line\">\theader(&apos;Content-Type:application/json; charset=utf-8&apos;);</span><br><span class=\"line\">\t$result = file_get_contents(&apos;stars.json&apos;);</span><br><span class=\"line\">\techo $result;</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></div></figure>\n<p>运行结果:<img src=\"http://images.cnblogs.com/cnblogs_com/cliy-10/1240733/t_19.png\" alt=\" \"></p>\n<p><code>parse()</code>方法的作用：将JSON格式的字符串类型转化为JavaScript对象</p>\n<p>为什么要转化呢？</p>\n<p>我们应该都知道不同的语言都有着自己的一套语法规则，比如说不同语言定义变量、定义数组、定义对象的方式肯定都有所不同，所以不同的语言之间的通信是通过字符串来表示的，比如说JSON格式的字符串，用””双引号包起来的不管是对象也好，数组也好，在不同的语言都是可以运行通过的，并不会报错，当各个不同的语言接收到了这个字符串之后，就利用自己所对应语言所封装的方法转化成自己可以识别的对象，以便后续的操作，比如说在JavaScript预言中，将JSON格式的字符串类型转化为JavaScript对象的方法是<code>parse()</code>。</p>\n<p><img src=\"http://images.cnblogs.com/cnblogs_com/cliy-10/1240733/o_20.png\" alt=\" \" class=\"article-img\"></p>\n<p>现在我们可以得到一个毫无疑问的答案，JSON格式的数据要比XML格式的数据简单的多，我们以后还是尽量用JSON格式的数据，XML格式的数据已经淘汰了呢。</p>\n<p>我们得需要了解一下XMLHttpRequest在标准浏览器和IE浏览器存在着兼容性问题，我们需要一个兼容性的写法</p>\n<p><img src=\"http://images.cnblogs.com/cnblogs_com/cliy-10/1240733/o_21.png\" alt=\" \" class=\"article-img\"></p>\n","prev":{"title":"ajax()函数的封装","link":"2018/07/15/封装的ajax()函数"},"next":{"title":"less的基本使用","link":"2018/07/09/less的使用基本语法"},"plink":"http://yoursite.com/2018/07/12/浅谈ajax/","toc":[{"title":"1.XMLHttpRequest","id":"1-XMLHttpRequest","index":"1"},{"title":"2.同步","id":"2-同步","index":"2"},{"title":"3.XMLHttpRequest传递数据","id":"3-XMLHttpRequest传递数据","index":"3"},{"title":"4.XMLHttpRequest实现局部更新功能(表单事件提交)","id":"4-XMLHttpRequest实现局部更新功能-表单事件提交","index":"4"},{"title":"5.简单的总结","id":"5-简单的总结","index":"5","children":[{"title":"5.1.请求","id":"5-1-请求","index":"5.1"},{"title":"5.2.响应","id":"5-2-响应","index":"5.2"},{"title":"5.3.API详解","id":"5-3-API详解","index":"5.3"},{"title":"5.5.GET大小限制约4K，POST则没有限制。","id":"5-5-GET大小限制约4K，POST则没有限制。","index":"5.4"}]},{"title":"6.XML数据VSJSON数据","id":"6-XML数据VSJSON数据","index":"6","children":[{"title":"6.1.XML数据","id":"6-1-XML数据","index":"6.1"},{"title":"6.2.JSON：即JavaScript Object Notation，另一种轻量级的文本数据交换格式，独立于语言。","id":"6-2-JSON：即JavaScript-Object-Notation，另一种轻量级的文本数据交换格式，独立于语言。","index":"6.2"}]}]}